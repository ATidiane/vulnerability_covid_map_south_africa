import cufflinks as cf
import matplotlib.pyplot as plt
import pandas as pd
import plotly as py
import plotly.io as pio
import seaborn as sns
from plotly.offline import iplot
from plotly.subplots import make_subplots

cf.go_offline(connected=True)
init_notebook_mode(connected=True)

sns.set(style='whitegrid')
pio.renderers.default = 'colab'


def correlation_matrix(dataset, features, y, title, annot=False):
    """
    """

    corr = pd.DataFrame(np.hstack(
        (dataset[features[:-1]].values, y.reshape(-1, 1))), columns=features).corr()
    plt.figure(figsize=(16, 12))
    plt.title(title, fontsize=18)
    sns.heatmap(
        corr,
        annot=annot,
        cmap='BrBG',
        linewidths=0.2,
        annot_kws={
            'size': 10})
    plt.show()


def interactive_results(y_train, y_train_pred, y_test, y_test_pred):
    pio.renderers.default = 'colab'
    cf.set_config_file(theme='pearl')
    fig = make_subplots(rows=2, cols=1, shared_xaxes=False)

    enum_x_train = list(range(len(y_train)))
    enum_x_test = list(range(len(y_test)))

    fig.append_trace({'x': enum_x_train, 'y': y_train, 'type': 'scatter',
                      'name': 'Real | Train'}, 1, 1)
    fig.append_trace({'x': enum_x_train, 'y': y_train_pred, 'type': 'scatter', 'opacity': 0.7,
                      'name': 'Predicted | Train'}, 1, 1)
    fig.append_trace({'x': enum_x_test, 'y': y_test, 'type': 'scatter',
                      'name': 'Real | Test'}, 2, 1)
    fig.append_trace({'x': enum_x_test, 'y': y_test_pred, 'type': 'scatter', 'opacity': 0.7,
                      'name': 'Predicted | Test'}, 2, 1)
    #fig['layout'].update(title=title+ ' | RMSE: '+str(RMSE))
    iplot(fig)
